import"./style-928bxCnj.js";import{f as m}from"./fetch-CGUiTqyx.js";document.addEventListener("DOMContentLoaded",function(){const o=document.querySelector(".menu-toggle"),n=document.querySelector(".menu");o.addEventListener("click",function(){n.classList.toggle("show")})});const u=document.getElementById("exercise-form");u.addEventListener("submit",D);const s=document.getElementById("edit-modal"),b=document.querySelector(".close-button"),v=document.getElementById("edit-form");b.onclick=()=>s.style.display="none";window.onclick=o=>{o.target===s&&(s.style.display="none")};async function D(o){o.preventDefault();const n=localStorage.getItem("user_id");if(!n){alert("User ID not found. Please log in again.");return}const t=new FormData(u),e={};t.forEach((r,i)=>{e[i]=r}),console.log(e),e.user_id=n;try{const r=`http://localhost:3000/api/entries/nutrition/${n}`,a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)};if(!(await fetch(r,a)).ok)throw new Error("Failed to add nutrition entry");u.reset(),alert("MNutrition entry added successfully!")}catch(r){console.error("Error adding nutrition entry:",r.message),alert("Failed to add nutrition entry. Please try again.")}}async function g(){const n=`http://localhost:3000/api/entries/nutrition/${localStorage.getItem("user_id")}`,e={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};m(n,e).then(r=>{L(r)})}function L(o){console.log(o);const n=document.querySelector(".tbody");n.innerHTML="",o.forEach(t=>{console.log(t.entry_date,t.calories_consumed,t.carbohydrates_grams,t.protein_grams,t.fat_grams,t.notes);const e=document.createElement("tr"),r=new Date(t.entry_date).toLocaleDateString("fi-FI"),i=document.createElement("td");i.innerText=r;const a=document.createElement("td");a.innerText=t.calories_consumed;const l=document.createElement("td");l.innerText=t.carbohydrates_grams;const y=document.createElement("td");y.innerText=t.protein_grams;const p=document.createElement("td");p.innerText=t.fat_grams;const h=document.createElement("td");h.innerText=t.notes;const f=document.createElement("td"),c=document.createElement("button");c.className="del",c.setAttribute("nutrition_id",t.nutrition_id),c.innerText="Delete",f.appendChild(c),c.addEventListener("click",I);const E=document.createElement("td"),d=document.createElement("button");d.className="edit",d.setAttribute("nutrition-id",t.nutrition_id),d.setAttribute("data-nutrition-id",t.nutrition_id),d.innerText="Edit",d.addEventListener("click",k=>_(k,o)),E.appendChild(d),e.appendChild(i),e.appendChild(a),e.appendChild(l),e.appendChild(y),e.appendChild(p),e.appendChild(h),e.appendChild(f),e.appendChild(E),n.appendChild(e)}),document.querySelectorAll(".del").forEach(t=>t.addEventListener("click",I)),document.querySelectorAll(".edit").forEach(t=>t.addEventListener("click",e=>_(e,o)))}function _(o,n){const t=parseInt(o.target.dataset.nutritionId,10);console.log("Nutrition ID:",t);const e=n.find(r=>r.nutrition_id===t);document.getElementById("edit-entry-id").value=t,document.getElementById("edit-date").value=e.entry_date,document.getElementById("edit-calories-consumed").value=e.calories_consumed,document.getElementById("edit-carbohydrates-grams").value=e.carbohydrates_grams,document.getElementById("edit-protein-grams").value=e.protein_grams,document.getElementById("edit-fat-grams").value=e.fat_grams,document.getElementById("edit-notes").value=e.notes,s.style.display="block"}v.addEventListener("submit",async o=>{o.preventDefault();const n=new FormData(o.target),t=n.get("edit-entry-id");console.log("FormData:",n);const e=`http://localhost:3000/api/entries/nutrition/${t}`,i={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({entry_date:n.get("edit-date"),calories_consumed:n.get("edit-calories-consumed"),carbohydrates_grams:n.get("edit-carbohydrates-grams"),protein_grams:n.get("edit-protein-grams"),fat_grams:n.get("edit-fat-grams"),notes:n.get("edit-notes")})};m(e,i).then(()=>{s.style.display="none",g()})});async function I(o){console.log(o);const n=o.target.attributes.nutrition_id.value;console.log(n);const t=`http://localhost:3000/api/entries/nutrition/${n}`,r={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Are you sure you want to delete this nutrition entry?")&&m(t,r).then(a=>{console.log(a),g()})}document.getElementById("fetch-data").addEventListener("click",g);document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(n){n.preventDefault(),localStorage.removeItem("user_id"),localStorage.removeItem("token"),window.location.href="login.html"})});
