import"./style-928bxCnj.js";import{f as g}from"./fetch-CGUiTqyx.js";document.addEventListener("DOMContentLoaded",function(){const n=document.querySelector(".menu-toggle"),o=document.querySelector(".menu");n.addEventListener("click",function(){o.classList.toggle("show")})});const h=document.getElementById("exercise-form");h.addEventListener("submit",_);const i=document.getElementById("edit-modal"),I=document.querySelector(".close-button"),k=document.getElementById("edit-form");I.onclick=()=>i.style.display="none";window.onclick=n=>{n.target===i&&(i.style.display="none")};async function _(n){n.preventDefault();const o=localStorage.getItem("user_id");if(!o){alert("User ID not found. Please log in again.");return}const e=new FormData(h),t={};e.forEach((r,d)=>{t[d]=r}),console.log(t);const a=new Date().toISOString();t.created_at=a,t.user_id=o;try{const r=`http://localhost:3000/api/entries/hrv/${o}`,l={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)};if(!(await fetch(r,l)).ok)throw new Error("Failed to add HRV Measurement");h.reset(),alert("HRV measurement added successfully!")}catch(r){console.error("Error adding HRV measurement:",r.message),alert("Failed to add HRM measurement. Please try again.")}}const D=document.querySelector("#fetch-data");D.addEventListener("click",u);async function u(){const o=`http://localhost:3000/api/entries/hrv/${localStorage.getItem("user_id")}`,t={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};g(o,t).then(a=>{S(a)})}function S(n){console.log(n);const o=document.querySelector(".tbody");o.innerHTML="",n.forEach(e=>{console.log(e.measurement_date,e.time_of_day,e.hrv_value,e.notes);const t=document.createElement("tr"),a=new Date(e.measurement_date).toLocaleDateString("fi-FI"),r=document.createElement("td");r.innerText=a;const d=document.createElement("td");d.innerText=e.time_of_day;const l=document.createElement("td");l.innerText=e.hrv_value;const m=document.createElement("td");m.innerText=e.notes;const v=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("hrv_id",e.hrv_id),s.innerText="Delete",v.appendChild(s),s.addEventListener("click",f);const y=document.createElement("td"),c=document.createElement("button");c.className="edit",c.setAttribute("hrv-id",e.hrv_id),c.setAttribute("data-hrv-id",e.hrv_id),c.innerText="Edit",c.addEventListener("click",E=>p(E,n)),y.appendChild(c),t.appendChild(r),t.appendChild(d),t.appendChild(l),t.appendChild(m),t.appendChild(v),t.appendChild(y),o.appendChild(t)}),document.querySelectorAll(".del").forEach(e=>e.addEventListener("click",f)),document.querySelectorAll(".edit").forEach(e=>e.addEventListener("click",t=>p(t,n)))}function p(n,o){const e=parseInt(n.target.dataset.hrvId,10);console.log("HRV ID:",e);const t=o.find(a=>a.hrv_id===e);document.getElementById("edit-entry-id").value=e,document.getElementById("edit-date").value=t.measurement_date,document.getElementById("edit-time-of-day").value=t.time_of_day,document.getElementById("edit-hrv-value").value=t.hrv_value,document.getElementById("edit-notes").value=t.notes,i.style.display="block"}k.addEventListener("submit",async n=>{n.preventDefault();const o=new FormData(n.target),e=o.get("edit-entry-id");console.log("FormData:",o);const t=`http://localhost:3000/api/entries/hrv/${e}`,r={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({measurement_date:o.get("edit-date"),time_of_day:o.get("edit-time-of-day"),hrv_value:o.get("edit-hrv-value"),notes:o.get("edit-notes")})};g(t,r).then(()=>{i.style.display="none",u()})});async function f(n){console.log(n);const o=n.target.attributes.hrv_id.value;console.log(o);const e=`http://localhost:3000/api/entries/hrv/${o}`,a={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Are you sure you want to delete HRV?")&&g(e,a).then(d=>{console.log(d),u()})}document.getElementById("fetch-data").addEventListener("click",u);document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(o){o.preventDefault(),localStorage.removeItem("user_id"),localStorage.removeItem("token"),window.location.href="login.html"})});
