import"./style-Bprq5g8c.js";import{f as g}from"./fetch-CGUiTqyx.js";import{s}from"./toast-B-6j1RQv.js";document.addEventListener("DOMContentLoaded",function(){const o=document.querySelector(".menu-toggle"),n=document.querySelector(".menu");o.addEventListener("click",function(){n.classList.toggle("show")})});const m=document.getElementById("exercise-form");m.addEventListener("submit",L);const u=document.getElementById("edit-modal"),v=document.querySelector(".close-button"),D=document.getElementById("edit-form");v.onclick=()=>u.style.display="none";window.onclick=o=>{o.target===u&&(u.style.display="none")};async function L(o){o.preventDefault();const n=localStorage.getItem("user_id");if(!n){alert("User ID not found. Please log in again.");return}const t=new FormData(m),e={};t.forEach((r,i)=>{e[i]=r}),console.log(e),e.user_id=n;try{const r=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/nutrition/${n}`,d={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(e)};if(!(await fetch(r,d)).ok)throw new Error("Failed to add nutrition entry");m.reset(),s("Nutrition entry added successfully!")}catch{s("Failed to add nutrition entry. Please try again.")}}async function p(){const n=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/nutrition/${localStorage.getItem("user_id")}`,e={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};g(n,e).then(r=>{S(r)})}function S(o){console.log(o);const n=document.querySelector(".tbody");n.innerHTML="",o.forEach(t=>{console.log(t.entry_date,t.calories_consumed,t.carbohydrates_grams,t.protein_grams,t.fat_grams,t.notes);const e=document.createElement("tr"),r=new Date(t.entry_date).toLocaleDateString("fi-FI"),i=document.createElement("td");i.innerText=r;const d=document.createElement("td");d.innerText=t.calories_consumed;const l=document.createElement("td");l.innerText=t.carbohydrates_grams;const y=document.createElement("td");y.innerText=t.protein_grams;const h=document.createElement("td");h.innerText=t.fat_grams;const f=document.createElement("td");f.innerText=t.notes;const E=document.createElement("td"),c=document.createElement("button");c.className="del",c.setAttribute("nutrition_id",t.nutrition_id),c.innerText="Delete",E.appendChild(c),c.addEventListener("click",k);const _=document.createElement("td"),a=document.createElement("button");a.className="edit",a.setAttribute("nutrition-id",t.nutrition_id),a.setAttribute("data-nutrition-id",t.nutrition_id),a.innerText="Edit",a.addEventListener("click",b=>I(b,o)),_.appendChild(a),e.appendChild(i),e.appendChild(d),e.appendChild(l),e.appendChild(y),e.appendChild(h),e.appendChild(f),e.appendChild(E),e.appendChild(_),n.appendChild(e)}),document.querySelectorAll(".del").forEach(t=>t.addEventListener("click",k)),document.querySelectorAll(".edit").forEach(t=>t.addEventListener("click",e=>I(e,o)))}function I(o,n){const t=parseInt(o.target.dataset.nutritionId,10);console.log("Nutrition ID:",t);const e=n.find(r=>r.nutrition_id===t);document.getElementById("edit-entry-id").value=t,document.getElementById("edit-date").value=e.entry_date,document.getElementById("edit-calories-consumed").value=e.calories_consumed,document.getElementById("edit-carbohydrates-grams").value=e.carbohydrates_grams,document.getElementById("edit-protein-grams").value=e.protein_grams,document.getElementById("edit-fat-grams").value=e.fat_grams,document.getElementById("edit-notes").value=e.notes,u.style.display="block"}D.addEventListener("submit",async o=>{o.preventDefault();const n=new FormData(o.target),t=n.get("edit-entry-id");console.log("FormData:",n);const e=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/nutrition/${t}`,i={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({entry_date:n.get("edit-date"),calories_consumed:n.get("edit-calories-consumed"),carbohydrates_grams:n.get("edit-carbohydrates-grams"),protein_grams:n.get("edit-protein-grams"),fat_grams:n.get("edit-fat-grams"),notes:n.get("edit-notes")})};g(e,i).then(()=>{u.style.display="none",s("Nutrition entry updated"),p()})});async function k(o){console.log(o);const n=o.target.attributes.nutrition_id.value;console.log(n);const t=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/nutrition/${n}`,r={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Are you sure you want to delete this nutrition entry?")&&g(t,r).then(d=>{console.log(d),s("Nutrition entry deleted"),p()})}document.getElementById("fetch-data").addEventListener("click",p);document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(n){n.preventDefault(),s("Logging out"),localStorage.removeItem("user_id"),localStorage.removeItem("token"),setTimeout(()=>{window.location.href="index.html"},2e3)})});
