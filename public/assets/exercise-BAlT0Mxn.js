import"./style-BLTyQJKc.js";import{f as y}from"./fetch-CGUiTqyx.js";import{s}from"./toast-B-6j1RQv.js";document.addEventListener("DOMContentLoaded",function(){const n=document.querySelector(".menu-toggle"),t=document.querySelector(".menu");n.addEventListener("click",function(){t.classList.toggle("show")})});const p=document.getElementById("exercise-form");p.addEventListener("submit",D);const l=document.getElementById("edit-modal"),I=document.querySelector(".close-button"),v=document.getElementById("edit-form");I.onclick=()=>l.style.display="none";window.onclick=n=>{n.target===l&&(l.style.display="none")};async function D(n){n.preventDefault();const t=localStorage.getItem("user_id");if(!t){alert("User ID not found. Please log in again.");return}const e=new FormData(p),o={};e.forEach((r,c)=>{o[c]=r}),console.log(o),o.user_id=t;try{const r=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/exercise/${t}`,d={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(o)};if(!(await fetch(r,d)).ok)throw new Error("Failed to add exercise");p.reset(),s("Exercise added successfully!")}catch(r){console.error("Error adding exercise:",r.message),s("Failed to add exercise. Please try again.")}}const L=document.querySelector("#fetch-data");L.addEventListener("click",u);async function u(){const t=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/exercise/${localStorage.getItem("user_id")}`,o={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};y(t,o).then(r=>{S(r)})}function S(n){console.log(n);const t=document.querySelector(".tbody");t.innerHTML="",n.forEach(e=>{console.log(e.date,e.type,e.duration,e.intensity);const o=document.createElement("tr"),r=new Date(e.date).toLocaleDateString("fi-FI"),c=document.createElement("td");c.innerText=r;const d=document.createElement("td");d.innerText=e.type;const m=document.createElement("td");m.innerText=e.duration;const g=document.createElement("td");g.innerText=e.intensity;const h=document.createElement("td"),a=document.createElement("button");a.className="del",a.setAttribute("exercise_id",e.exercise_id),a.innerText="Delete",h.appendChild(a),a.addEventListener("click",x);const E=document.createElement("td"),i=document.createElement("button");i.className="edit",i.setAttribute("exercise-id",e.exercise_id),i.setAttribute("data-exercise-id",e.exercise_id),i.innerText="Edit",i.addEventListener("click",k=>f(k,n)),E.appendChild(i),o.appendChild(c),o.appendChild(d),o.appendChild(m),o.appendChild(g),o.appendChild(h),o.appendChild(E),t.appendChild(o)}),document.querySelectorAll(".del").forEach(e=>e.addEventListener("click",x)),document.querySelectorAll(".edit").forEach(e=>e.addEventListener("click",o=>f(o,n)))}function f(n,t){const e=parseInt(n.target.dataset.exerciseId,10);console.log("Entry ID:",e);const o=t.find(r=>r.exercise_id===e);document.getElementById("edit-entry-id").value=e,document.getElementById("edit-date").value=o.date,document.getElementById("edit-type").value=o.type,document.getElementById("edit-duration").value=o.duration,document.getElementById("edit-intensity").value=o.intensity,l.style.display="block"}v.addEventListener("submit",async n=>{n.preventDefault();const t=new FormData(n.target),e=t.get("edit-entry-id");console.log("FormData:",t);const o=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/exercise/${e}`,c={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({date:t.get("edit-date"),type:t.get("edit-type"),duration:t.get("edit-duration"),intensity:t.get("edit-intensity")})};y(o,c).then(()=>{l.style.display="none",s("Nutrition entry updated!"),u()})});async function x(n){console.log(n);const t=n.target.attributes.exercise_id.value;console.log(t);const e=`https://hyte24.northeurope.cloudapp.azure.com/api/entries/exercise/${t}`,r={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Are you sure you want to delete exercise?")&&y(e,r).then(d=>{console.log(d),s("Exercise deleted"),u()})}document.getElementById("fetch-data").addEventListener("click",u);document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(t){t.preventDefault(),s("Logging out"),localStorage.removeItem("user_id"),localStorage.removeItem("token"),setTimeout(()=>{window.location.href="login.html"},2e3)})});
