import"./style-928bxCnj.js";import{f as y}from"./fetch-CGUiTqyx.js";document.addEventListener("DOMContentLoaded",function(){const n=document.querySelector(".menu-toggle"),o=document.querySelector(".menu");n.addEventListener("click",function(){o.classList.toggle("show")})});const u=document.getElementById("exercise-form");console.log(u);u.addEventListener("submit",L);const v=document.querySelector("#fetch-data");v.addEventListener("click",m);const l=document.getElementById("edit-modal"),D=document.querySelector(".close-button"),w=document.getElementById("edit-form");D.onclick=()=>l.style.display="none";window.onclick=n=>{n.target===l&&(l.style.display="none")};async function L(n){n.preventDefault();const o=localStorage.getItem("user_id"),e=new FormData(u),t={};e.forEach((d,r)=>{t[r]=d,console.log(t)}),t.user_id=o;try{const d=`http://localhost:3000/api/entries/${o}`,a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)},i=await fetch(d,a);if(console.log(i),!i.ok)throw new Error("Failed to add diary entry");u.reset(),alert("Diary entry added successfully!")}catch(d){console.error("Error adding diary entry:",d.message),alert("Failed to add diary entry. Please try again.")}}async function m(){const o=`http://localhost:3000/api/entries/diaries/${localStorage.getItem("user_id")}`,t={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};y(o,t).then(d=>{S(d)})}function S(n){console.log(n);const o=document.querySelector(".tbody");o.innerHTML="",n.forEach(e=>{console.log(e.entry_date,e.mood,e.weight,e.sleep_hours,e.notes,e.created_at);const t=document.createElement("tr"),d=new Date(e.entry_date).toLocaleDateString("fi-FI"),r=document.createElement("td");r.innerText=d;const a=document.createElement("td");a.innerText=e.mood;const i=document.createElement("td");i.innerText=e.weight;const g=document.createElement("td");g.innerText=e.sleep_hours;const h=document.createElement("td");h.innerText=e.notes;const p=document.createElement("td"),s=document.createElement("button");s.className="del",s.setAttribute("entry-id",e.entry_id),s.innerText="Delete",s.addEventListener("click",I),p.appendChild(s);const E=document.createElement("td"),c=document.createElement("button");c.className="edit",c.setAttribute("entry-id",e.entry_id),c.setAttribute("data-entry-id",e.entry_id),c.innerText="Edit",c.addEventListener("click",k=>f(k,n)),E.appendChild(c),t.appendChild(r),t.appendChild(a),t.appendChild(i),t.appendChild(g),t.appendChild(h),t.appendChild(p),t.appendChild(E),o.appendChild(t)}),document.querySelectorAll(".del").forEach(e=>e.addEventListener("click",I)),document.querySelectorAll(".edit").forEach(e=>e.addEventListener("click",t=>f(t,n)))}function f(n,o){console.log(n.target.dataset.entryId);const e=parseInt(n.target.dataset.entryId,10);console.log("Entry ID:",e);const t=o.find(d=>d.entry_id===e);document.getElementById("edit-entry-id").value=e,document.getElementById("edit-date").value=t.entry_date,document.getElementById("edit-mood").value=t.mood,document.getElementById("edit-weight").value=t.weight,document.getElementById("edit-sleep").value=t.sleep_hours,document.getElementById("edit-notes").value=t.notes,l.style.display="block"}w.addEventListener("submit",async n=>{n.preventDefault();const o=new FormData(n.target),e=o.get("edit-entry-id");console.log("FormData:",o);const t=`http://localhost:3000/api/entries/${e}`,r={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({entry_date:o.get("edit-date"),mood:o.get("edit-mood"),weight:o.get("edit-weight"),sleep_hours:o.get("edit-sleep"),notes:o.get("edit-notes")})};y(t,r).then(()=>{l.style.display="none",m()})});async function I(n){console.log(n);const o=n.target.attributes["entry-id"].value;console.log(o);const e=`http://localhost:3000/api/entries/${o}`,d={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Are you sure you want to delete entry?")&&y(e,d).then(a=>{console.log(a),m()})}document.getElementById("fetch-data").addEventListener("click",m);document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(o){o.preventDefault(),localStorage.removeItem("user_id"),localStorage.removeItem("token"),window.location.href="login.html"})});
