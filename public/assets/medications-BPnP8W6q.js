import"./style-928bxCnj.js";import{f as u}from"./fetch-CGUiTqyx.js";document.addEventListener("DOMContentLoaded",function(){const o=document.querySelector(".menu-toggle"),n=document.querySelector(".menu");o.addEventListener("click",function(){n.classList.toggle("show")})});const m=document.getElementById("exercise-form");m.addEventListener("submit",L);const s=document.getElementById("edit-modal"),k=document.querySelector(".close-button"),v=document.getElementById("edit-form");k.onclick=()=>s.style.display="none";window.onclick=o=>{o.target===s&&(s.style.display="none")};async function L(o){o.preventDefault();const n=localStorage.getItem("user_id");if(!n){alert("User ID not found. Please log in again.");return}const e=new FormData(m),t={};e.forEach((d,a)=>{t[a]=d}),console.log(t),t.user_id=n;try{const d=`http://localhost:3000/api/entries/medications/${n}`,c={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(t)};if(!(await fetch(d,c)).ok)throw new Error("Failed to add medication");m.reset(),alert("Medication added successfully!")}catch(d){console.error("Error adding medication:",d.message),alert("Failed to add medication. Please try again.")}}async function g(){const n=`http://localhost:3000/api/entries/medications/${localStorage.getItem("user_id")}`,t={method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};u(n,t).then(d=>{S(d)})}function S(o){console.log(o);const n=document.querySelector(".tbody");n.innerHTML="",o.forEach(e=>{console.log(e.name,e.dosage,e.frequency,e.start_date,e.end_date);const t=document.createElement("tr"),d=document.createElement("td");d.innerText=e.name;const a=document.createElement("td");a.innerText=e.dosage;const c=document.createElement("td");c.innerText=e.frequency;const l=document.createElement("td");l.innerText=e.start_date;const y=document.createElement("td");y.innerText=e.end_date;const p=document.createElement("td"),r=document.createElement("button");r.className="del",r.setAttribute("medication_id",e.medication_id),r.innerText="Delete",p.appendChild(r),r.addEventListener("click",f);const h=document.createElement("td"),i=document.createElement("button");i.className="edit",i.setAttribute("medication-id",e.medication_id),i.setAttribute("data-medication-id",e.medication_id),i.innerText="Edit",i.addEventListener("click",I=>E(I,o)),h.appendChild(i),t.appendChild(d),t.appendChild(a),t.appendChild(c),t.appendChild(l),t.appendChild(y),t.appendChild(p),t.appendChild(h),n.appendChild(t)}),document.querySelectorAll(".del").forEach(e=>e.addEventListener("click",f)),document.querySelectorAll(".edit").forEach(e=>e.addEventListener("click",t=>E(t,o)))}function E(o,n){console.log(o.target.dataset.medicationId);const e=parseInt(o.target.dataset.medicationId,10);console.log("Entry ID:",e);const t=n.find(d=>d.medication_id===e);document.getElementById("edit-entry-id").value=e,document.getElementById("edit-name").value=t.name,document.getElementById("edit-dosage").value=t.dosage,document.getElementById("edit-frequency").value=t.frequency,document.getElementById("edit-start-date").value=t.start_date,document.getElementById("edit-end-date").value=t.end_date,s.style.display="block"}v.addEventListener("submit",async o=>{o.preventDefault();const n=new FormData(o.target),e=n.get("edit-entry-id");console.log("FormData:",n);const t=`http://localhost:3000/api/entries/medications/${e}`,a={method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:n.get("edit-name"),dosage:n.get("edit-dosage"),frequency:n.get("edit-frequency"),start_date:n.get("edit-start-date"),end_date:n.get("edit-end-date")})};u(t,a).then(()=>{s.style.display="none",g()})});async function f(o){console.log(o);const n=o.target.attributes.medication_id.value;console.log(n);const e=`http://localhost:3000/api/entries/medications/${n}`,d={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Are you sure you want to delete medication?")&&u(e,d).then(c=>{console.log(c),g()})}document.getElementById("fetch-data").addEventListener("click",g);document.addEventListener("DOMContentLoaded",function(){document.querySelector(".logout a").addEventListener("click",function(n){n.preventDefault(),localStorage.removeItem("user_id"),localStorage.removeItem("token"),window.location.href="login.html"})});
